<!DOCTYPE html><!--y4ai2pig0HfXnXhnekuZf--><html lang="en"><head><meta charSet="UTF-8"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/Training-Archive/_next/static/media/cc27cf3ff100ea21-s.p.ttf" as="font" crossorigin="" type="font/ttf"/><link rel="stylesheet" href="/Training-Archive/_next/static/css/dd3bbe79ef28f60a.css" data-precedence="next"/><link rel="stylesheet" href="/Training-Archive/_next/static/css/9f4210e542df69af.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/Training-Archive/_next/static/chunks/webpack-12683b4c0beed4e8.js"/><script src="/Training-Archive/_next/static/chunks/6ae3b393-4b033cbd06089d1e.js" async=""></script><script src="/Training-Archive/_next/static/chunks/255-1436767215191b46.js" async=""></script><script src="/Training-Archive/_next/static/chunks/main-app-e0c5a520a19df54e.js" async=""></script><script src="/Training-Archive/_next/static/chunks/1951f239-e4c7a40f4938f7cd.js" async=""></script><script src="/Training-Archive/_next/static/chunks/81-d563b76c84969650.js" async=""></script><script src="/Training-Archive/_next/static/chunks/app/view/contests/%5Bcontest%5D/problems/%5Bproblem%5D/%5Bfile%5D/page-8b159e72c21ca0c8.js" async=""></script><link rel="icon" type="image/png" href="https://appleblue17.github.io/Training-Archive/archive-bot.png"/><title>Training Archive</title><meta name="next-size-adjust" content=""/><script src="/Training-Archive/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_e3f162 antialiased"><div hidden=""><!--$--><!--/$--></div><div class="flex min-h-screen justify-center py-4"><div class="mx-auto w-4/5"><header class="relative w-full rounded-lg py-2 text-slate-300"><h1 class="text-2xl font-semibold tracking-wide">File Viewer</h1><p class="ml-4 mt-2 text-base text-gray-400"><span class="px-2 text-lg text-gray-200">/</span>2024-12-13 The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)<span class="px-2 text-lg text-slate-300">/</span>F<span class="px-2 text-lg text-slate-300">/</span>solution_wxq.md</p><div class="absolute right-8 top-2 flex items-center gap-2"><a href="/Training-Archive/contests/2024-12-13 The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)/problems/F/solution_wxq.md" download="" class="rounded bg-gray-700 px-3 py-1 text-sm text-white hover:bg-gray-600"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-2 inline-block text-base" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>Download</a><a href="/Training-Archive/contests/2024-12-13 The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)/problems/F/solution_wxq.md" target="_blank" rel="noopener noreferrer" class="rounded bg-gray-700 px-3 py-1 text-sm text-white hover:bg-gray-600"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-2 inline-block text-base" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>Raw File</a></div></header><main class="mt-4 flex w-full items-start justify-center gap-4"><div class="flex-grow"><div class="relative flex h-[85dvh] w-full min-w-0 max-w-full flex-col overflow-hidden rounded border-2 border-gray-600 bg-[#0d1117]"><button class="absolute right-6 top-4 z-10 rounded bg-gray-700 px-3 py-1 text-sm text-white hover:bg-gray-600"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-1 inline-block" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>Copy</button><div class="flex-1 overflow-y-auto p-12"><div class="markdown-body">
<p><a href="https://qoj.ac/contest/1041">link</a></p>
<p>你的细节很多，但是你的时限弥补了这一点。</p>
<p>考虑每 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
        <semantics>
          <mrow>
            <mi>C</mi>
          </mrow>
          <annotation encoding="application/x-tex">C</annotation>
        </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span> 个划分一个块，那么一个合法的最大子段和要么在块内，要么跨两个相邻的块。</p>
<p>第一类的维护是简单的。</p>
<p>第二类考虑前缀和，对于相邻的两段，一个合法的最大子段和需要满足 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
        <semantics>
          <mrow>
            <mi>l</mi>
            <mo>></mo>
            <mi>r</mi>
            <mo>−</mo>
            <mi>C</mi>
          </mrow>
          <annotation encoding="application/x-tex">l> r-C</annotation>
        </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7335em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>，放在前缀和上就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
        <semantics>
          <mrow>
            <mi>l</mi>
            <mo>≥</mo>
            <mi>r</mi>
            <mo>−</mo>
            <mi>C</mi>
          </mrow>
          <annotation encoding="application/x-tex">l\geq r-C</annotation>
        </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>。</p>
<p>在线段树上用半在线的方式就能维护这个东西，再用一棵线段树维护相邻整块的答案。</p>
<p>剩下的就是散块对相邻的整块。</p>
<p>可能有好处理的方法，我的方法比较笨：把其他的都赋值为负无穷，再在半在线线段树上询问。</p>
<p>复杂度是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
        <semantics>
          <mrow>
            <mi>O</mi>
            <mo stretchy="false">(</mo>
            <mi>n</mi>
            <mi>log</mi>
            <mo>⁡</mo>
            <mi>n</mi>
            <mo stretchy="false">)</mo>
          </mrow>
          <annotation encoding="application/x-tex">O(n\log n)</annotation>
        </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，常数很大。</p>
<pre><code class="hljs language-cpp"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> GCC optimize(2)</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&#x3C;bits/stdc++.h></span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ll;
<span class="hljs-keyword">typedef</span> <span class="hljs-type">double</span> dou;
<span class="hljs-keyword">typedef</span> pair&#x3C;<span class="hljs-type">int</span>,<span class="hljs-type">int</span>> pii;
<span class="hljs-meta">#<span class="hljs-keyword">define</span> fi first</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> se second</span>
<span class="hljs-meta">#<span class="hljs-keyword">define</span> mapa make_pair</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-type">long</span> <span class="hljs-type">double</span> ld;
<span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> <span class="hljs-type">long</span> ull;
<span class="hljs-meta">#<span class="hljs-keyword">define</span> ep emplace_back</span>
<span class="hljs-keyword">template</span> &#x3C;<span class="hljs-keyword">typename</span> T><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">read</span><span class="hljs-params">(T &#x26;x)</span></span>{
	x=<span class="hljs-number">0</span>;<span class="hljs-type">char</span> c=<span class="hljs-built_in">getchar</span>();<span class="hljs-type">bool</span> f=<span class="hljs-number">0</span>;
	<span class="hljs-keyword">for</span>(;c&#x3C;<span class="hljs-string">'0'</span>||c><span class="hljs-string">'9'</span>;c=<span class="hljs-built_in">getchar</span>()) f|=(c==<span class="hljs-string">'-'</span>);
	<span class="hljs-keyword">for</span>(;c>=<span class="hljs-string">'0'</span>&#x26;&#x26;c&#x3C;=<span class="hljs-string">'9'</span>;c=<span class="hljs-built_in">getchar</span>())
	x=(x&#x3C;&#x3C;<span class="hljs-number">1</span>)+(x&#x3C;&#x3C;<span class="hljs-number">3</span>)+(c^<span class="hljs-number">48</span>);
	x=(f?-x:x);
}
<span class="hljs-type">const</span> <span class="hljs-type">int</span> N=<span class="hljs-number">4e5</span><span class="hljs-number">+5</span>;
<span class="hljs-type">int</span> n, m, c;
<span class="hljs-type">int</span> a[N];
ll sum[N];
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">T1</span>{
	<span class="hljs-keyword">struct</span> <span class="hljs-title class_">info</span>{
		ll ans, ls, rs, sum;
		<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span></span>{
			sum=x;
			ans=<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, x);
			ls=rs=ans;
		}
	}tr[N&#x3C;&#x3C;<span class="hljs-number">2</span>];
	<span class="hljs-keyword">inline</span> <span class="hljs-keyword">friend</span> info <span class="hljs-keyword">operator</span> +(info x, info y){
		info z;
		z.ans=<span class="hljs-built_in">max</span>(x.ans, y.ans);
		z.sum=x.sum+y.sum;
		z.ls=<span class="hljs-built_in">max</span>(x.ls, x.sum+y.ls);
		z.rs=<span class="hljs-built_in">max</span>(y.rs, y.sum+x.rs);
		z.ans=<span class="hljs-built_in">max</span>(z.ans, x.rs+y.ls);
		<span class="hljs-keyword">return</span> z;
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span></span>{
		<span class="hljs-keyword">if</span>(l==r){
			tr[p].<span class="hljs-built_in">set</span>(a[l]);
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-built_in">build</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid);
		<span class="hljs-built_in">build</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r);
		tr[p]=tr[p&#x3C;&#x3C;<span class="hljs-number">1</span>]+tr[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>];
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mdf</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> x, <span class="hljs-type">int</span> v)</span></span>{
		<span class="hljs-keyword">if</span>(l==r){
			tr[p].<span class="hljs-built_in">set</span>(v);
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-keyword">if</span>(x&#x3C;=mid) <span class="hljs-built_in">mdf</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid, x, v);
		<span class="hljs-keyword">else</span> <span class="hljs-built_in">mdf</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r, x, v);
		tr[p]=tr[p&#x3C;&#x3C;<span class="hljs-number">1</span>]+tr[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>];
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> L, <span class="hljs-type">int</span> R, info &#x26;ret)</span></span>{
		<span class="hljs-keyword">if</span>(L>R) <span class="hljs-keyword">return</span> ;
		<span class="hljs-keyword">if</span>(L&#x3C;=l&#x26;&#x26;r&#x3C;=R){
			ret=ret+tr[p];
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-keyword">if</span>(L&#x3C;=mid) <span class="hljs-built_in">get</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid, L, R, ret);
		<span class="hljs-keyword">if</span>(R>mid) <span class="hljs-built_in">get</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r, L, R, ret);
	}
}t1;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">T2</span>{
	ll a[N&#x3C;&#x3C;<span class="hljs-number">2</span>], b[N&#x3C;&#x3C;<span class="hljs-number">2</span>], mx[N&#x3C;&#x3C;<span class="hljs-number">2</span>], taga[N&#x3C;&#x3C;<span class="hljs-number">2</span>], tagb[N&#x3C;&#x3C;<span class="hljs-number">2</span>];
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span></span>{
		<span class="hljs-keyword">if</span>(l==r){
			a[p]=sum[l]; b[p]=sum[l+c];
			mx[p]=b[p]-a[p];
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-built_in">build</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid); <span class="hljs-built_in">build</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r);
		a[p]=<span class="hljs-built_in">min</span>(a[p&#x3C;&#x3C;<span class="hljs-number">1</span>], a[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		b[p]=<span class="hljs-built_in">max</span>(b[p&#x3C;&#x3C;<span class="hljs-number">1</span>], b[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		mx[p]=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>], mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]), b[p&#x3C;&#x3C;<span class="hljs-number">1</span>]-a[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">down</span><span class="hljs-params">(<span class="hljs-type">int</span> p)</span></span>{
		<span class="hljs-keyword">if</span>(taga[p]!=<span class="hljs-number">0</span>){
			taga[p&#x3C;&#x3C;<span class="hljs-number">1</span>]+=taga[p];
			a[p&#x3C;&#x3C;<span class="hljs-number">1</span>]+=taga[p];
			mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>]-=taga[p];
			taga[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]+=taga[p];
			a[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]+=taga[p];
			mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]-=taga[p];
			taga[p]=<span class="hljs-number">0</span>;
		}
		<span class="hljs-keyword">if</span>(tagb[p]!=<span class="hljs-number">0</span>){
			tagb[p&#x3C;&#x3C;<span class="hljs-number">1</span>]+=tagb[p];
			b[p&#x3C;&#x3C;<span class="hljs-number">1</span>]+=tagb[p];
			mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>]+=tagb[p];
			tagb[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]+=tagb[p];
			b[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]+=tagb[p];
			mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]+=tagb[p];
			tagb[p]=<span class="hljs-number">0</span>;
		}
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mdfa</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> L, <span class="hljs-type">int</span> R, ll v)</span></span>{
		<span class="hljs-keyword">if</span>(L>R) <span class="hljs-keyword">return</span> ;
		<span class="hljs-keyword">if</span>(L&#x3C;=l&#x26;&#x26;r&#x3C;=R){
			taga[p]+=v;
			a[p]+=v;
			mx[p]-=v;
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-built_in">down</span>(p);
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-keyword">if</span>(L&#x3C;=mid) <span class="hljs-built_in">mdfa</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid, L, R, v);
		<span class="hljs-keyword">if</span>(R>mid) <span class="hljs-built_in">mdfa</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r, L, R, v);
		a[p]=<span class="hljs-built_in">min</span>(a[p&#x3C;&#x3C;<span class="hljs-number">1</span>], a[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		b[p]=<span class="hljs-built_in">max</span>(b[p&#x3C;&#x3C;<span class="hljs-number">1</span>], b[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		mx[p]=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>], mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]), b[p&#x3C;&#x3C;<span class="hljs-number">1</span>]-a[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mdfb</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> L, <span class="hljs-type">int</span> R, ll v)</span></span>{
		<span class="hljs-keyword">if</span>(L>R) <span class="hljs-keyword">return</span> ;
		<span class="hljs-keyword">if</span>(L&#x3C;=l&#x26;&#x26;r&#x3C;=R){
			tagb[p]+=v;
			b[p]+=v;
			mx[p]+=v;
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-built_in">down</span>(p);
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-keyword">if</span>(L&#x3C;=mid) <span class="hljs-built_in">mdfb</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid, L, R, v);
		<span class="hljs-keyword">if</span>(R>mid) <span class="hljs-built_in">mdfb</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r, L, R, v);
		a[p]=<span class="hljs-built_in">min</span>(a[p&#x3C;&#x3C;<span class="hljs-number">1</span>], a[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		b[p]=<span class="hljs-built_in">max</span>(b[p&#x3C;&#x3C;<span class="hljs-number">1</span>], b[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		mx[p]=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>], mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]), b[p&#x3C;&#x3C;<span class="hljs-number">1</span>]-a[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">qry</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> L, <span class="hljs-type">int</span> R, ll &#x26;pa, ll &#x26;pb, ll &#x26;pans)</span></span>{
		<span class="hljs-keyword">if</span>(L>R) <span class="hljs-keyword">return</span> ;
		<span class="hljs-keyword">if</span>(L&#x3C;=l&#x26;&#x26;r&#x3C;=R){
			pans=<span class="hljs-built_in">max</span>(<span class="hljs-built_in">max</span>(pans, mx[p]), pb-a[p]);
			pa=<span class="hljs-built_in">min</span>(pa, a[p]);
			pb=<span class="hljs-built_in">max</span>(pb, b[p]);
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-built_in">down</span>(p);
		<span class="hljs-keyword">if</span>(L&#x3C;=mid) <span class="hljs-built_in">qry</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid, L, R, pa, pb, pans);
		<span class="hljs-keyword">if</span>(R>mid) <span class="hljs-built_in">qry</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r, L, R, pa, pb, pans);
	}
}t2;
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">T3</span>{
	ll mx[N&#x3C;&#x3C;<span class="hljs-number">2</span>], mx2[N&#x3C;&#x3C;<span class="hljs-number">2</span>];
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r)</span></span>{
		<span class="hljs-keyword">if</span>(l==r){
			T1::info tem; tem.<span class="hljs-built_in">set</span>(<span class="hljs-number">0</span>);
			t<span class="hljs-number">1.</span><span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n, (l<span class="hljs-number">-1</span>)*c<span class="hljs-number">+1</span>, l*c, tem);
			mx2[p]=tem.ans;
			mx[p]=<span class="hljs-number">0</span>;
			ll pa=<span class="hljs-number">1e18</span>, pb=<span class="hljs-number">-1e18</span>;
			t<span class="hljs-number">2.</span><span class="hljs-built_in">qry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, (l<span class="hljs-number">-1</span>)*c<span class="hljs-number">+1</span>, l*c, pa, pb, mx[p]);
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-built_in">build</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid); <span class="hljs-built_in">build</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r);
		mx[p]=<span class="hljs-built_in">max</span>(mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>], mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		mx2[p]=<span class="hljs-built_in">max</span>(mx2[p&#x3C;&#x3C;<span class="hljs-number">1</span>], mx2[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
	}
	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">mdf</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> x)</span></span>{
		<span class="hljs-keyword">if</span>(l==r){
			T1::info tem; tem.<span class="hljs-built_in">set</span>(<span class="hljs-number">0</span>);
			t<span class="hljs-number">1.</span><span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n, (l<span class="hljs-number">-1</span>)*c<span class="hljs-number">+1</span>, l*c, tem);
			mx2[p]=tem.ans;
			mx[p]=<span class="hljs-number">0</span>;
			ll pa=<span class="hljs-number">1e18</span>, pb=<span class="hljs-number">-1e18</span>;
			t<span class="hljs-number">2.</span><span class="hljs-built_in">qry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, (l<span class="hljs-number">-1</span>)*c<span class="hljs-number">+1</span>, l*c, pa, pb, mx[p]);
			<span class="hljs-keyword">return</span> ;
		}
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>;
		<span class="hljs-keyword">if</span>(x&#x3C;=mid) <span class="hljs-built_in">mdf</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid, x);
		<span class="hljs-keyword">else</span> <span class="hljs-built_in">mdf</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r, x);
		mx[p]=<span class="hljs-built_in">max</span>(mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>], mx[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
		mx2[p]=<span class="hljs-built_in">max</span>(mx2[p&#x3C;&#x3C;<span class="hljs-number">1</span>], mx2[p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>]);
	}
	<span class="hljs-function">ll <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> L, <span class="hljs-type">int</span> R)</span></span>{
		<span class="hljs-keyword">if</span>(L>R) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
		<span class="hljs-keyword">if</span>(L&#x3C;=l&#x26;&#x26;r&#x3C;=R) <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(mx[p], mx2[p]);
		<span class="hljs-type">int</span> mid=(l+r)>><span class="hljs-number">1</span>; ll ret=<span class="hljs-number">0</span>;
		<span class="hljs-keyword">if</span>(L&#x3C;=mid) ret=<span class="hljs-built_in">get</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>, l, mid, L, R);
		<span class="hljs-keyword">if</span>(R>mid) ret=<span class="hljs-built_in">max</span>(ret, <span class="hljs-built_in">get</span>(p&#x3C;&#x3C;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid<span class="hljs-number">+1</span>, r, L, R));
		<span class="hljs-keyword">return</span> ret;
	}
}t3;
<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>{
	<span class="hljs-comment">// freopen("D:\\nya\\acm\\A\\test.in","r",stdin);</span>
	<span class="hljs-comment">// freopen("D:\\nya\\acm\\A\\test.out","w",stdout);</span>
	<span class="hljs-built_in">read</span>(n); <span class="hljs-built_in">read</span>(m); <span class="hljs-built_in">read</span>(c);
	<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>; i&#x3C;=n; ++i) <span class="hljs-built_in">read</span>(a[i]), sum[i]=sum[i<span class="hljs-number">-1</span>]+a[i];
	<span class="hljs-keyword">if</span>(n==c) a[++n]=<span class="hljs-number">-1e9</span>, sum[n]=sum[n<span class="hljs-number">-1</span>]+a[n];
	<span class="hljs-keyword">while</span>(n%c) a[++n]=<span class="hljs-number">-1e9</span>, sum[n]=sum[n<span class="hljs-number">-1</span>]+a[n];
	t<span class="hljs-number">1.</span><span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);
	t<span class="hljs-number">2.</span><span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c);
	t<span class="hljs-number">3.</span><span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n/c<span class="hljs-number">-1</span>);
	<span class="hljs-type">int</span> tp, x, y;
	<span class="hljs-keyword">while</span>(m--){
		<span class="hljs-built_in">read</span>(tp); <span class="hljs-built_in">read</span>(x); <span class="hljs-built_in">read</span>(y);
		<span class="hljs-keyword">if</span>(tp==<span class="hljs-number">1</span>){
			t<span class="hljs-number">1.</span><span class="hljs-built_in">mdf</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n, x, y);
			t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfa</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, x, n-c, y-a[x]);
			t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfb</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, x-c), n-c, y-a[x]);
			<span class="hljs-keyword">if</span>((x<span class="hljs-number">-1</span>)/c>=<span class="hljs-number">1</span>) t<span class="hljs-number">3.</span><span class="hljs-built_in">mdf</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n/c<span class="hljs-number">-1</span>, (x<span class="hljs-number">-1</span>)/c);
			<span class="hljs-keyword">if</span>((x<span class="hljs-number">-1</span>)/c<span class="hljs-number">+1</span>&#x3C;=n/c<span class="hljs-number">-1</span>) t<span class="hljs-number">3.</span><span class="hljs-built_in">mdf</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n/c<span class="hljs-number">-1</span>, (x<span class="hljs-number">-1</span>)/c<span class="hljs-number">+1</span>);
			a[x]=y;
		}
		<span class="hljs-keyword">else</span>{
			ll ans=<span class="hljs-number">0</span>;
			ll pa=<span class="hljs-number">1e18</span>, pb=<span class="hljs-number">-1e18</span>;
			t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfa</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-number">1</span>, x<span class="hljs-number">-1</span>, <span class="hljs-number">1e16</span>); t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfa</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, y<span class="hljs-number">+1</span>, n-c, <span class="hljs-number">1e16</span>);
			t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfb</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-number">1</span>, x-c<span class="hljs-number">-1</span>, <span class="hljs-number">-1e16</span>); t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfb</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, y-c<span class="hljs-number">+1</span>), n-c, <span class="hljs-number">-1e16</span>);
			t<span class="hljs-number">2.</span><span class="hljs-built_in">qry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, x, <span class="hljs-built_in">min</span>(n-c, x+c<span class="hljs-number">-1</span>), pa, pb, ans);
			pa=<span class="hljs-number">1e18</span>, pb=<span class="hljs-number">-1e18</span>;
			t<span class="hljs-number">2.</span><span class="hljs-built_in">qry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, y-c*<span class="hljs-number">2</span><span class="hljs-number">+1</span>), y-c, pa, pb, ans);
			t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfa</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-number">1</span>, x<span class="hljs-number">-1</span>, <span class="hljs-number">-1e16</span>); t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfa</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, y<span class="hljs-number">+1</span>, n-c, <span class="hljs-number">-1e16</span>);
			t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfb</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-number">1</span>, x-c<span class="hljs-number">-1</span>, <span class="hljs-number">1e16</span>); t<span class="hljs-number">2.</span><span class="hljs-built_in">mdfb</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n-c, <span class="hljs-built_in">max</span>(<span class="hljs-number">1</span>, y-c<span class="hljs-number">+1</span>), n-c, <span class="hljs-number">1e16</span>);
			T1::info tem; tem.<span class="hljs-built_in">set</span>(<span class="hljs-number">0</span>);
			t<span class="hljs-number">1.</span><span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n, x, <span class="hljs-built_in">min</span>(y, x+c<span class="hljs-number">-1</span>), tem);
			ans=<span class="hljs-built_in">max</span>(ans, tem.ans);
			tem.<span class="hljs-built_in">set</span>(<span class="hljs-number">0</span>);
			t<span class="hljs-number">1.</span><span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n, <span class="hljs-built_in">max</span>(x, y-c<span class="hljs-number">+1</span>), y, tem);
			ans=<span class="hljs-built_in">max</span>(ans, tem.ans);
			<span class="hljs-keyword">if</span>((y<span class="hljs-number">-1</span>)/c>(x<span class="hljs-number">-1</span>)/c<span class="hljs-number">+1</span>){
				<span class="hljs-comment">// cout&#x3C;&#x3C;(x-1)/c+2&#x3C;&#x3C;' '&#x3C;&#x3C;(y-1)/c-1&#x3C;&#x3C;endl;</span>
				ans=<span class="hljs-built_in">max</span>(ans, t<span class="hljs-number">3.</span><span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n/c<span class="hljs-number">-1</span>, (x<span class="hljs-number">-1</span>)/c<span class="hljs-number">+2</span>, (y<span class="hljs-number">-1</span>)/c<span class="hljs-number">-1</span>));
				tem.<span class="hljs-built_in">set</span>(<span class="hljs-number">0</span>);
				t<span class="hljs-number">1.</span><span class="hljs-built_in">get</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n, ((y<span class="hljs-number">-1</span>)/c<span class="hljs-number">-1</span>)*c<span class="hljs-number">+1</span>, ((y<span class="hljs-number">-1</span>)/c)*c, tem);
				ans=<span class="hljs-built_in">max</span>(ans, tem.ans);
			}
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, ans);
		}
	}
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
</div></div></div></div><div class="flex-shrink-0 basis-1/5 space-y-2 overflow-auto"><div class="overflow-auto"><h2 class="px-1 py-1 text-sm font-medium text-gray-300">File</h2><div class="rounded border-2 border-gray-400 bg-black/80 px-2 py-3 font-mono text-sm text-green-300"><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Name<!-- -->]</span> <span class="text-green-200">solution_wxq.md</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Size<!-- -->]</span> <span class="text-yellow-400">6.691 KB (6852 B)</span></div></div></div><div class="overflow-auto"><h2 class="px-1 py-1 text-sm font-medium text-gray-300">Problem</h2><div class="rounded border-2 border-gray-400 bg-black/80 px-2 py-3 font-mono text-sm text-green-300"><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Name<!-- -->]</span> <span class="text-green-200">Vacation</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Link<!-- -->]</span> <a href="https://qoj.ac/contest/1041/problem/5069" target="_blank" rel="noopener noreferrer" class="text-indigo-400 underline hover:text-indigo-200">https://qoj.ac/contest/1041/problem/5069</a></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Time Limit<!-- -->]</span> <span class="text-yellow-400">4 s</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Memory Limit<!-- -->]</span> <span class="text-yellow-400">1024 MB</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Solved<!-- -->]</span> <span class="text-cyan-400">true</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Submit Time<!-- -->]</span> <span class="text-pink-400">2025/08/02 14:06:39</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Solve Time<!-- -->]</span> <span class="text-pink-400">2025/08/02 14:06:39</span></div></div></div><div class="overflow-auto"><h2 class="px-1 py-1 text-sm font-medium text-gray-300">Contest</h2><div class="rounded border-2 border-gray-400 bg-black/80 px-2 py-3 font-mono text-sm text-green-300"><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Name<!-- -->]</span> <span class="text-green-200">The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Date<!-- -->]</span> <span class="text-pink-400">2024-12-13</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Platform<!-- -->]</span> <span class="text-green-200">qoj</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Start Time<!-- -->]</span> <span class="text-pink-400">2024/12/13 21:10:28</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->End Time<!-- -->]</span> <span class="text-pink-400">2024/12/14 02:10:28</span></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Link<!-- -->]</span> <a href="https://qoj.ac/contest/1041" target="_blank" rel="noopener noreferrer" class="text-indigo-400 underline hover:text-indigo-200">https://qoj.ac/contest/1041</a></div><div class="mb-1 break-all" style="text-indent:-1.2em;padding-left:1.2em"><span class="text-blue-400">[<!-- -->Difficulty<!-- -->]</span> <span class="text-yellow-300">5</span></div></div></div></div></main></div></div><!--$--><!--/$--><footer class="my-4"><p class="mt-0 border-t border-gray-700 pt-4 text-center text-sm text-gray-400">© 2025 Training Archive ·<!-- --> <a href="https://github.com/appleblue17/Training-Archive/" target="_blank" rel="noopener noreferrer" class="hover:text-blue-300"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-1 inline" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>GitHub</a> <!-- -->· MIT License</p><p class="mt-2 text-center text-sm text-gray-400">Designed and developed by<a href="https://github.com/Appleblue17" target="_blank" rel="noopener noreferrer" class="px-1 text-blue-400 hover:text-blue-300">Appleblue17</a></p><p class="mt-2 text-center text-xs text-gray-500">Disclaimer: This project is for educational purposes only. Use at your own risk.</p></footer><script src="/Training-Archive/_next/static/chunks/webpack-12683b4c0beed4e8.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8521,[],\"\"]\n3:I[1661,[],\"\"]\nb:I[939,[],\"\"]\n:HL[\"/Training-Archive/_next/static/media/cc27cf3ff100ea21-s.p.ttf\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/ttf\"}]\n:HL[\"/Training-Archive/_next/static/css/dd3bbe79ef28f60a.css\",\"style\"]\n:HL[\"/Training-Archive/_next/static/css/9f4210e542df69af.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"y4ai2pig0HfXnXhnekuZf\",\"p\":\"/Training-Archive\",\"c\":[\"\",\"view\",\"contests\",\"2024-12-13%20The%202021%20ICPC%20Asia%20East%20Continent%20Final%20Contest%20(EC-Final%202021)\",\"problems\",\"F\",\"solution_wxq.md\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"view\",{\"children\":[\"contests\",{\"children\":[[\"contest\",\"2024-12-13%20The%202021%20ICPC%20Asia%20East%20Continent%20Final%20Contest%20(EC-Final%202021)\",\"d\"],{\"children\":[\"problems\",{\"children\":[[\"problem\",\"F\",\"d\"],{\"children\":[[\"file\",\"solution_wxq.md\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/Training-Archive/_next/static/css/dd3bbe79ef28f60a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"charSet\":\"UTF-8\"}],[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"href\":\"https://appleblue17.github.io/Training-Archive/archive-bot.png\"}],[\"$\",\"title\",null,{\"children\":\"Training Archive\"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_e3f162 antialiased\",\"children\":[[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"footer\",null,{\"className\":\"my-4\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mt-0 border-t border-gray-700 pt-4 text-center text-sm text-gray-400\",\"children\":[\"© 2025 Training Archive ·\",\" \",[\"$\",\"a\",null,{\"href\":\"https://github.com/appleblue17/Training-Archive/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-blue-300\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"none\",\"strokeWidth\":\"2\",\"viewBox\":\"0 0 24 24\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"mr-1 inline\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],\"GitHub\"]}],\" \",\"· MIT License\"]}],[\"$\",\"p\",null,{\"className\":\"mt-2 text-center text-sm text-gray-400\",\"children\":[\"Designed and developed by\",[\"$\",\"a\",null,{\"href\":\"https://github.com/Appleblue17\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"px-1 text-blue-400 hover:text-blue-300\",\"children\":\"Appleblue17\"}]]}],[\"$\",\"p\",null,{\"className\":\"mt-2 text-center text-xs text-gray-500\",\"children\":\"Disclaimer: This project is for educational purposes only. Use at your own risk.\"}]]}]]}]]}]]}],{\"children\":[\"view\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"contests\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":\"$L4\",\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"contest\",\"2024-12-13%20The%202021%20ICPC%20Asia%20East%20Continent%20Final%20Contest%20(EC-Final%202021)\",\"d\"],\"$L5\",{\"children\":[\"problems\",\"$L6\",{\"children\":[[\"problem\",\"F\",\"d\"],\"$L7\",{\"children\":[[\"file\",\"solution_wxq.md\",\"d\"],\"$L8\",{\"children\":[\"__PAGE__\",\"$L9\",{},null,false]},null,false]},null,false]},null,false]},null,false]},null,false]},null,false]},null,false],\"$La\",false]],\"m\":\"$undefined\",\"G\":[\"$b\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:I[7055,[],\"OutletBoundary\"]\nf:I[9909,[],\"AsyncMetadataOutlet\"]\n11:I[7055,[],\"ViewportBoundary\"]\n13:I[7055,[],\"MetadataBoundary\"]\n14:\"$Sreact.suspense\"\n4:[\"$\",\"$L3\",null,{}]\n5:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\n6:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\n7:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\n8:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\n9:[\"$\",\"$1\",\"c\",{\"children\":[\"$Lc\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/Training-Archive/_next/static/css/9f4210e542df69af.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$Ld\",null,{\"children\":[\"$Le\",[\"$\",\"$Lf\",null,{\"promise\":\"$@10\"}]]}]]}]\na:[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$L11\",null,{\"children\":\"$L12\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$L13\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$14\",null,{\"fallback\":null,\"children\":\"$L15\"}]}]}]"])</script><script>self.__next_f.push([1,"]}]\n"])</script><script>self.__next_f.push([1,"c:[\"$\",\"div\",null,{\"className\":\"flex min-h-screen justify-center py-4\",\"children\":[\"$\",\"div\",null,{\"className\":\"mx-auto w-4/5\",\"children\":[[\"$\",\"header\",null,{\"className\":\"relative w-full rounded-lg py-2 text-slate-300\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl font-semibold tracking-wide\",\"children\":\"File Viewer\"}],[\"$\",\"p\",null,{\"className\":\"ml-4 mt-2 text-base text-gray-400\",\"children\":[[\"$\",\"span\",null,{\"className\":\"px-2 text-lg text-gray-200\",\"children\":\"/\"}],\"2024-12-13 The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)\",[\"$\",\"span\",null,{\"className\":\"px-2 text-lg text-slate-300\",\"children\":\"/\"}],\"F\",[\"$\",\"span\",null,{\"className\":\"px-2 text-lg text-slate-300\",\"children\":\"/\"}],\"solution_wxq.md\"]}],[\"$\",\"div\",null,{\"className\":\"absolute right-8 top-2 flex items-center gap-2\",\"children\":[[\"$\",\"a\",null,{\"href\":\"/Training-Archive/contests/2024-12-13 The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)/problems/F/solution_wxq.md\",\"download\":true,\"className\":\"rounded bg-gray-700 px-3 py-1 text-sm text-white hover:bg-gray-600\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"none\",\"strokeWidth\":\"2\",\"viewBox\":\"0 0 24 24\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"mr-2 inline-block text-base\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\",\"children\":[]}],[\"$\",\"polyline\",\"1\",{\"points\":\"7 10 12 15 17 10\",\"children\":[]}],[\"$\",\"line\",\"2\",{\"x1\":\"12\",\"y1\":\"15\",\"x2\":\"12\",\"y2\":\"3\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],\"Download\"]}],[\"$\",\"a\",null,{\"href\":\"/Training-Archive/contests/2024-12-13 The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)/problems/F/solution_wxq.md\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"rounded bg-gray-700 px-3 py-1 text-sm text-white hover:bg-gray-600\",\"children\":[[\"$\",\"svg\",null,{\"stroke\":\"currentColor\",\"fill\":\"none\",\"strokeWidth\":\"2\",\"viewBox\":\"0 0 24 24\",\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"mr-2 inline-block text-base\",\"children\":[\"$undefined\",[[\"$\",\"path\",\"0\",{\"d\":\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\",\"children\":[]}],[\"$\",\"polyline\",\"1\",{\"points\":\"14 2 14 8 20 8\",\"children\":[]}],[\"$\",\"line\",\"2\",{\"x1\":\"16\",\"y1\":\"13\",\"x2\":\"8\",\"y2\":\"13\",\"children\":[]}],[\"$\",\"line\",\"3\",{\"x1\":\"16\",\"y1\":\"17\",\"x2\":\"8\",\"y2\":\"17\",\"children\":[]}],[\"$\",\"polyline\",\"4\",{\"points\":\"10 9 9 9 8 9\",\"children\":[]}]]],\"style\":{\"color\":\"$undefined\"},\"height\":\"1em\",\"width\":\"1em\",\"xmlns\":\"http://www.w3.org/2000/svg\"}],\"Raw File\"]}]]}]]}],[\"$\",\"main\",null,{\"className\":\"mt-4 flex w-full items-start justify-center gap-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-grow\",\"children\":\"$L16\"}],[\"$\",\"div\",null,{\"className\":\"flex-shrink-0 basis-1/5 space-y-2 overflow-auto\",\"children\":[[\"$\",\"div\",null,{\"className\":\"overflow-auto\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"px-1 py-1 text-sm font-medium text-gray-300\",\"children\":\"File\"}],[\"$\",\"div\",null,{\"className\":\"rounded border-2 border-gray-400 bg-black/80 px-2 py-3 font-mono text-sm text-green-300\",\"children\":[[\"$\",\"div\",\"name\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Name\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-green-200\",\"children\":\"solution_wxq.md\"}]]}],[\"$\",\"div\",\"size\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Size\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-yellow-400\",\"children\":\"6.691 KB (6852 B)\"}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"overflow-auto\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"px-1 py-1 text-sm font-medium text-gray-300\",\"children\":\"Problem\"}],[\"$\",\"div\",null,{\"className\":\"rounded border-2 border-gray-400 bg-black/80 px-2 py-3 font-mono text-sm text-green-300\",\"children\":[[\"$\",\"div\",\"name\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Name\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-green-200\",\"children\":\"Vacation\"}]]}],[\"$\",\"div\",\"link\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Link\",\"]\"]}],\" \",\"$L17\"]}],\"$L18\",\"$L19\",\"$L1a\",\"$L1b\",\"$L1c\"]}]]}],\"$L1d\"]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"a\",null,{\"href\":\"https://qoj.ac/contest/1041/problem/5069\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-indigo-400 underline hover:text-indigo-200\",\"children\":\"https://qoj.ac/contest/1041/problem/5069\"}]\n18:[\"$\",\"div\",\"time_limit\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Time Limit\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-yellow-400\",\"children\":\"4 s\"}]]}]\n19:[\"$\",\"div\",\"memory_limit\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Memory Limit\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-yellow-400\",\"children\":\"1024 MB\"}]]}]\n1a:[\"$\",\"div\",\"solved\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Solved\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-cyan-400\",\"children\":\"true\"}]]}]\n1b:[\"$\",\"div\",\"submit_time\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Submit Time\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-pink-400\",\"children\":\"2025/08/02 14:06:39\"}]]}]\n1c:[\"$\",\"div\",\"solve_time\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Solve Time\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-pink-400\",\"children\":\"2025/08/02 14:06:39\"}]]}]\n"])</script><script>self.__next_f.push([1,"1d:[\"$\",\"div\",null,{\"className\":\"overflow-auto\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"px-1 py-1 text-sm font-medium text-gray-300\",\"children\":\"Contest\"}],[\"$\",\"div\",null,{\"className\":\"rounded border-2 border-gray-400 bg-black/80 px-2 py-3 font-mono text-sm text-green-300\",\"children\":[[\"$\",\"div\",\"name\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Name\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-green-200\",\"children\":\"The 2021 ICPC Asia East Continent Final Contest (EC-Final 2021)\"}]]}],[\"$\",\"div\",\"date\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Date\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-pink-400\",\"children\":\"2024-12-13\"}]]}],[\"$\",\"div\",\"platform\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Platform\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-green-200\",\"children\":\"qoj\"}]]}],[\"$\",\"div\",\"start_time\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Start Time\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-pink-400\",\"children\":\"2024/12/13 21:10:28\"}]]}],[\"$\",\"div\",\"end_time\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"End Time\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-pink-400\",\"children\":\"2024/12/14 02:10:28\"}]]}],[\"$\",\"div\",\"link\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Link\",\"]\"]}],\" \",[\"$\",\"a\",null,{\"href\":\"https://qoj.ac/contest/1041\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-indigo-400 underline hover:text-indigo-200\",\"children\":\"https://qoj.ac/contest/1041\"}]]}],[\"$\",\"div\",\"difficulty\",{\"className\":\"mb-1 break-all\",\"style\":{\"textIndent\":\"-1.2em\",\"paddingLeft\":\"1.2em\"},\"children\":[[\"$\",\"span\",null,{\"className\":\"text-blue-400\",\"children\":[\"[\",\"Difficulty\",\"]\"]}],\" \",[\"$\",\"span\",null,{\"className\":\"text-yellow-300\",\"children\":5}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1e:I[6005,[\"215\",\"static/chunks/1951f239-e4c7a40f4938f7cd.js\",\"81\",\"static/chunks/81-d563b76c84969650.js\",\"947\",\"static/chunks/app/view/contests/%5Bcontest%5D/problems/%5Bproblem%5D/%5Bfile%5D/page-8b159e72c21ca0c8.js\"],\"default\"]\n1f:T1ac4,"])</script><script>self.__next_f.push([1,"[link](https://qoj.ac/contest/1041)\n\n你的细节很多，但是你的时限弥补了这一点。\n\n考虑每 $C$ 个划分一个块，那么一个合法的最大子段和要么在块内，要么跨两个相邻的块。\n\n第一类的维护是简单的。\n\n第二类考虑前缀和，对于相邻的两段，一个合法的最大子段和需要满足 $l\u003e r-C$，放在前缀和上就是 $l\\geq r-C$。\n\n在线段树上用半在线的方式就能维护这个东西，再用一棵线段树维护相邻整块的答案。\n\n剩下的就是散块对相邻的整块。\n\n可能有好处理的方法，我的方法比较笨：把其他的都赋值为负无穷，再在半在线线段树上询问。\n\n复杂度是 $O(n\\log n)$，常数很大。\n\n```cpp\n#pragma GCC optimize(2)\n#include\u003cbits/stdc++.h\u003e\nusing namespace std;\ntypedef long long ll;\ntypedef double dou;\ntypedef pair\u003cint,int\u003e pii;\n#define fi first\n#define se second\n#define mapa make_pair\ntypedef long double ld;\ntypedef unsigned long long ull;\n#define ep emplace_back\ntemplate \u003ctypename T\u003einline void read(T \u0026x){\n\tx=0;char c=getchar();bool f=0;\n\tfor(;c\u003c'0'||c\u003e'9';c=getchar()) f|=(c=='-');\n\tfor(;c\u003e='0'\u0026\u0026c\u003c='9';c=getchar())\n\tx=(x\u003c\u003c1)+(x\u003c\u003c3)+(c^48);\n\tx=(f?-x:x);\n}\nconst int N=4e5+5;\nint n, m, c;\nint a[N];\nll sum[N];\nstruct T1{\n\tstruct info{\n\t\tll ans, ls, rs, sum;\n\t\tvoid set(int x){\n\t\t\tsum=x;\n\t\t\tans=max(0, x);\n\t\t\tls=rs=ans;\n\t\t}\n\t}tr[N\u003c\u003c2];\n\tinline friend info operator +(info x, info y){\n\t\tinfo z;\n\t\tz.ans=max(x.ans, y.ans);\n\t\tz.sum=x.sum+y.sum;\n\t\tz.ls=max(x.ls, x.sum+y.ls);\n\t\tz.rs=max(y.rs, y.sum+x.rs);\n\t\tz.ans=max(z.ans, x.rs+y.ls);\n\t\treturn z;\n\t}\n\tvoid build(int p, int l, int r){\n\t\tif(l==r){\n\t\t\ttr[p].set(a[l]);\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tbuild(p\u003c\u003c1, l, mid);\n\t\tbuild(p\u003c\u003c1|1, mid+1, r);\n\t\ttr[p]=tr[p\u003c\u003c1]+tr[p\u003c\u003c1|1];\n\t}\n\tvoid mdf(int p, int l, int r, int x, int v){\n\t\tif(l==r){\n\t\t\ttr[p].set(v);\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tif(x\u003c=mid) mdf(p\u003c\u003c1, l, mid, x, v);\n\t\telse mdf(p\u003c\u003c1|1, mid+1, r, x, v);\n\t\ttr[p]=tr[p\u003c\u003c1]+tr[p\u003c\u003c1|1];\n\t}\n\tvoid get(int p, int l, int r, int L, int R, info \u0026ret){\n\t\tif(L\u003eR) return ;\n\t\tif(L\u003c=l\u0026\u0026r\u003c=R){\n\t\t\tret=ret+tr[p];\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tif(L\u003c=mid) get(p\u003c\u003c1, l, mid, L, R, ret);\n\t\tif(R\u003emid) get(p\u003c\u003c1|1, mid+1, r, L, R, ret);\n\t}\n}t1;\nstruct T2{\n\tll a[N\u003c\u003c2], b[N\u003c\u003c2], mx[N\u003c\u003c2], taga[N\u003c\u003c2], tagb[N\u003c\u003c2];\n\tvoid build(int p, int l, int r){\n\t\tif(l==r){\n\t\t\ta[p]=sum[l]; b[p]=sum[l+c];\n\t\t\tmx[p]=b[p]-a[p];\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tbuild(p\u003c\u003c1, l, mid); build(p\u003c\u003c1|1, mid+1, r);\n\t\ta[p]=min(a[p\u003c\u003c1], a[p\u003c\u003c1|1]);\n\t\tb[p]=max(b[p\u003c\u003c1], b[p\u003c\u003c1|1]);\n\t\tmx[p]=max(max(mx[p\u003c\u003c1], mx[p\u003c\u003c1|1]), b[p\u003c\u003c1]-a[p\u003c\u003c1|1]);\n\t}\n\tvoid down(int p){\n\t\tif(taga[p]!=0){\n\t\t\ttaga[p\u003c\u003c1]+=taga[p];\n\t\t\ta[p\u003c\u003c1]+=taga[p];\n\t\t\tmx[p\u003c\u003c1]-=taga[p];\n\t\t\ttaga[p\u003c\u003c1|1]+=taga[p];\n\t\t\ta[p\u003c\u003c1|1]+=taga[p];\n\t\t\tmx[p\u003c\u003c1|1]-=taga[p];\n\t\t\ttaga[p]=0;\n\t\t}\n\t\tif(tagb[p]!=0){\n\t\t\ttagb[p\u003c\u003c1]+=tagb[p];\n\t\t\tb[p\u003c\u003c1]+=tagb[p];\n\t\t\tmx[p\u003c\u003c1]+=tagb[p];\n\t\t\ttagb[p\u003c\u003c1|1]+=tagb[p];\n\t\t\tb[p\u003c\u003c1|1]+=tagb[p];\n\t\t\tmx[p\u003c\u003c1|1]+=tagb[p];\n\t\t\ttagb[p]=0;\n\t\t}\n\t}\n\tvoid mdfa(int p, int l, int r, int L, int R, ll v){\n\t\tif(L\u003eR) return ;\n\t\tif(L\u003c=l\u0026\u0026r\u003c=R){\n\t\t\ttaga[p]+=v;\n\t\t\ta[p]+=v;\n\t\t\tmx[p]-=v;\n\t\t\treturn ;\n\t\t}\n\t\tdown(p);\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tif(L\u003c=mid) mdfa(p\u003c\u003c1, l, mid, L, R, v);\n\t\tif(R\u003emid) mdfa(p\u003c\u003c1|1, mid+1, r, L, R, v);\n\t\ta[p]=min(a[p\u003c\u003c1], a[p\u003c\u003c1|1]);\n\t\tb[p]=max(b[p\u003c\u003c1], b[p\u003c\u003c1|1]);\n\t\tmx[p]=max(max(mx[p\u003c\u003c1], mx[p\u003c\u003c1|1]), b[p\u003c\u003c1]-a[p\u003c\u003c1|1]);\n\t}\n\tvoid mdfb(int p, int l, int r, int L, int R, ll v){\n\t\tif(L\u003eR) return ;\n\t\tif(L\u003c=l\u0026\u0026r\u003c=R){\n\t\t\ttagb[p]+=v;\n\t\t\tb[p]+=v;\n\t\t\tmx[p]+=v;\n\t\t\treturn ;\n\t\t}\n\t\tdown(p);\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tif(L\u003c=mid) mdfb(p\u003c\u003c1, l, mid, L, R, v);\n\t\tif(R\u003emid) mdfb(p\u003c\u003c1|1, mid+1, r, L, R, v);\n\t\ta[p]=min(a[p\u003c\u003c1], a[p\u003c\u003c1|1]);\n\t\tb[p]=max(b[p\u003c\u003c1], b[p\u003c\u003c1|1]);\n\t\tmx[p]=max(max(mx[p\u003c\u003c1], mx[p\u003c\u003c1|1]), b[p\u003c\u003c1]-a[p\u003c\u003c1|1]);\n\t}\n\tvoid qry(int p, int l, int r, int L, int R, ll \u0026pa, ll \u0026pb, ll \u0026pans){\n\t\tif(L\u003eR) return ;\n\t\tif(L\u003c=l\u0026\u0026r\u003c=R){\n\t\t\tpans=max(max(pans, mx[p]), pb-a[p]);\n\t\t\tpa=min(pa, a[p]);\n\t\t\tpb=max(pb, b[p]);\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tdown(p);\n\t\tif(L\u003c=mid) qry(p\u003c\u003c1, l, mid, L, R, pa, pb, pans);\n\t\tif(R\u003emid) qry(p\u003c\u003c1|1, mid+1, r, L, R, pa, pb, pans);\n\t}\n}t2;\nstruct T3{\n\tll mx[N\u003c\u003c2], mx2[N\u003c\u003c2];\n\tvoid build(int p, int l, int r){\n\t\tif(l==r){\n\t\t\tT1::info tem; tem.set(0);\n\t\t\tt1.get(1, 1, n, (l-1)*c+1, l*c, tem);\n\t\t\tmx2[p]=tem.ans;\n\t\t\tmx[p]=0;\n\t\t\tll pa=1e18, pb=-1e18;\n\t\t\tt2.qry(1, 1, n-c, (l-1)*c+1, l*c, pa, pb, mx[p]);\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tbuild(p\u003c\u003c1, l, mid); build(p\u003c\u003c1|1, mid+1, r);\n\t\tmx[p]=max(mx[p\u003c\u003c1], mx[p\u003c\u003c1|1]);\n\t\tmx2[p]=max(mx2[p\u003c\u003c1], mx2[p\u003c\u003c1|1]);\n\t}\n\tvoid mdf(int p, int l, int r, int x){\n\t\tif(l==r){\n\t\t\tT1::info tem; tem.set(0);\n\t\t\tt1.get(1, 1, n, (l-1)*c+1, l*c, tem);\n\t\t\tmx2[p]=tem.ans;\n\t\t\tmx[p]=0;\n\t\t\tll pa=1e18, pb=-1e18;\n\t\t\tt2.qry(1, 1, n-c, (l-1)*c+1, l*c, pa, pb, mx[p]);\n\t\t\treturn ;\n\t\t}\n\t\tint mid=(l+r)\u003e\u003e1;\n\t\tif(x\u003c=mid) mdf(p\u003c\u003c1, l, mid, x);\n\t\telse mdf(p\u003c\u003c1|1, mid+1, r, x);\n\t\tmx[p]=max(mx[p\u003c\u003c1], mx[p\u003c\u003c1|1]);\n\t\tmx2[p]=max(mx2[p\u003c\u003c1], mx2[p\u003c\u003c1|1]);\n\t}\n\tll get(int p, int l, int r, int L, int R){\n\t\tif(L\u003eR) return 0;\n\t\tif(L\u003c=l\u0026\u0026r\u003c=R) return max(mx[p], mx2[p]);\n\t\tint mid=(l+r)\u003e\u003e1; ll ret=0;\n\t\tif(L\u003c=mid) ret=get(p\u003c\u003c1, l, mid, L, R);\n\t\tif(R\u003emid) ret=max(ret, get(p\u003c\u003c1|1, mid+1, r, L, R));\n\t\treturn ret;\n\t}\n}t3;\nint main(){\n\t// freopen(\"D:\\\\nya\\\\acm\\\\A\\\\test.in\",\"r\",stdin);\n\t// freopen(\"D:\\\\nya\\\\acm\\\\A\\\\test.out\",\"w\",stdout);\n\tread(n); read(m); read(c);\n\tfor(int i=1; i\u003c=n; ++i) read(a[i]), sum[i]=sum[i-1]+a[i];\n\tif(n==c) a[++n]=-1e9, sum[n]=sum[n-1]+a[n];\n\twhile(n%c) a[++n]=-1e9, sum[n]=sum[n-1]+a[n];\n\tt1.build(1, 1, n);\n\tt2.build(1, 1, n-c);\n\tt3.build(1, 1, n/c-1);\n\tint tp, x, y;\n\twhile(m--){\n\t\tread(tp); read(x); read(y);\n\t\tif(tp==1){\n\t\t\tt1.mdf(1, 1, n, x, y);\n\t\t\tt2.mdfa(1, 1, n-c, x, n-c, y-a[x]);\n\t\t\tt2.mdfb(1, 1, n-c, max(1, x-c), n-c, y-a[x]);\n\t\t\tif((x-1)/c\u003e=1) t3.mdf(1, 1, n/c-1, (x-1)/c);\n\t\t\tif((x-1)/c+1\u003c=n/c-1) t3.mdf(1, 1, n/c-1, (x-1)/c+1);\n\t\t\ta[x]=y;\n\t\t}\n\t\telse{\n\t\t\tll ans=0;\n\t\t\tll pa=1e18, pb=-1e18;\n\t\t\tt2.mdfa(1, 1, n-c, 1, x-1, 1e16); t2.mdfa(1, 1, n-c, y+1, n-c, 1e16);\n\t\t\tt2.mdfb(1, 1, n-c, 1, x-c-1, -1e16); t2.mdfb(1, 1, n-c, max(1, y-c+1), n-c, -1e16);\n\t\t\tt2.qry(1, 1, n-c, x, min(n-c, x+c-1), pa, pb, ans);\n\t\t\tpa=1e18, pb=-1e18;\n\t\t\tt2.qry(1, 1, n-c, max(1, y-c*2+1), y-c, pa, pb, ans);\n\t\t\tt2.mdfa(1, 1, n-c, 1, x-1, -1e16); t2.mdfa(1, 1, n-c, y+1, n-c, -1e16);\n\t\t\tt2.mdfb(1, 1, n-c, 1, x-c-1, 1e16); t2.mdfb(1, 1, n-c, max(1, y-c+1), n-c, 1e16);\n\t\t\tT1::info tem; tem.set(0);\n\t\t\tt1.get(1, 1, n, x, min(y, x+c-1), tem);\n\t\t\tans=max(ans, tem.ans);\n\t\t\ttem.set(0);\n\t\t\tt1.get(1, 1, n, max(x, y-c+1), y, tem);\n\t\t\tans=max(ans, tem.ans);\n\t\t\tif((y-1)/c\u003e(x-1)/c+1){\n\t\t\t\t// cout\u003c\u003c(x-1)/c+2\u003c\u003c' '\u003c\u003c(y-1)/c-1\u003c\u003cendl;\n\t\t\t\tans=max(ans, t3.get(1, 1, n/c-1, (x-1)/c+2, (y-1)/c-1));\n\t\t\t\ttem.set(0);\n\t\t\t\tt1.get(1, 1, n, ((y-1)/c-1)*c+1, ((y-1)/c)*c, tem);\n\t\t\t\tans=max(ans, tem.ans);\n\t\t\t}\n\t\t\tprintf(\"%lld\\n\", ans);\n\t\t}\n\t}\n\treturn 0;\n}\n```\n"])</script><script>self.__next_f.push([1,"20:T81dc,"])</script><script>self.__next_f.push([1,"\n\u003cp\u003e\u003ca href=\"https://qoj.ac/contest/1041\"\u003elink\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e你的细节很多，但是你的时限弥补了这一点。\u003c/p\u003e\n\u003cp\u003e考虑每 \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\n        \u003csemantics\u003e\n          \u003cmrow\u003e\n            \u003cmi\u003eC\u003c/mi\u003e\n          \u003c/mrow\u003e\n          \u003cannotation encoding=\"application/x-tex\"\u003eC\u003c/annotation\u003e\n        \u003c/semantics\u003e\n      \u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\"\u003eC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e 个划分一个块，那么一个合法的最大子段和要么在块内，要么跨两个相邻的块。\u003c/p\u003e\n\u003cp\u003e第一类的维护是简单的。\u003c/p\u003e\n\u003cp\u003e第二类考虑前缀和，对于相邻的两段，一个合法的最大子段和需要满足 \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\n        \u003csemantics\u003e\n          \u003cmrow\u003e\n            \u003cmi\u003el\u003c/mi\u003e\n            \u003cmo\u003e\u003e\u003c/mo\u003e\n            \u003cmi\u003er\u003c/mi\u003e\n            \u003cmo\u003e−\u003c/mo\u003e\n            \u003cmi\u003eC\u003c/mi\u003e\n          \u003c/mrow\u003e\n          \u003cannotation encoding=\"application/x-tex\"\u003el\u003e r-C\u003c/annotation\u003e\n        \u003c/semantics\u003e\n      \u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.7335em;vertical-align:-0.0391em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\"\u003eC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，放在前缀和上就是 \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\n        \u003csemantics\u003e\n          \u003cmrow\u003e\n            \u003cmi\u003el\u003c/mi\u003e\n            \u003cmo\u003e≥\u003c/mo\u003e\n            \u003cmi\u003er\u003c/mi\u003e\n            \u003cmo\u003e−\u003c/mo\u003e\n            \u003cmi\u003eC\u003c/mi\u003e\n          \u003c/mrow\u003e\n          \u003cannotation encoding=\"application/x-tex\"\u003el\\geq r-C\u003c/annotation\u003e\n        \u003c/semantics\u003e\n      \u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8304em;vertical-align:-0.136em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.01968em;\"\u003el\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e≥\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e−\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07153em;\"\u003eC\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e。\u003c/p\u003e\n\u003cp\u003e在线段树上用半在线的方式就能维护这个东西，再用一棵线段树维护相邻整块的答案。\u003c/p\u003e\n\u003cp\u003e剩下的就是散块对相邻的整块。\u003c/p\u003e\n\u003cp\u003e可能有好处理的方法，我的方法比较笨：把其他的都赋值为负无穷，再在半在线线段树上询问。\u003c/p\u003e\n\u003cp\u003e复杂度是 \u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\n        \u003csemantics\u003e\n          \u003cmrow\u003e\n            \u003cmi\u003eO\u003c/mi\u003e\n            \u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\n            \u003cmi\u003en\u003c/mi\u003e\n            \u003cmi\u003elog\u003c/mi\u003e\n            \u003cmo\u003e⁡\u003c/mo\u003e\n            \u003cmi\u003en\u003c/mi\u003e\n            \u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\n          \u003c/mrow\u003e\n          \u003cannotation encoding=\"application/x-tex\"\u003eO(n\\log n)\u003c/annotation\u003e\n        \u003c/semantics\u003e\n      \u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003eO\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mop\"\u003elo\u003cspan style=\"margin-right:0.01389em;\"\u003eg\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.1667em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e，常数很大。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-cpp\"\u003e\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003epragma\u003c/span\u003e GCC optimize(2)\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003einclude\u003c/span\u003e\u003cspan class=\"hljs-string\"\u003e\u0026#x3C;bits/stdc++.h\u003e\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eusing\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enamespace\u003c/span\u003e std;\n\u003cspan class=\"hljs-keyword\"\u003etypedef\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e ll;\n\u003cspan class=\"hljs-keyword\"\u003etypedef\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e dou;\n\u003cspan class=\"hljs-keyword\"\u003etypedef\u003c/span\u003e pair\u0026#x3C;\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e,\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e\u003e pii;\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003edefine\u003c/span\u003e fi first\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003edefine\u003c/span\u003e se second\u003c/span\u003e\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003edefine\u003c/span\u003e mapa make_pair\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etypedef\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003edouble\u003c/span\u003e ld;\n\u003cspan class=\"hljs-keyword\"\u003etypedef\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003elong\u003c/span\u003e ull;\n\u003cspan class=\"hljs-meta\"\u003e#\u003cspan class=\"hljs-keyword\"\u003edefine\u003c/span\u003e ep emplace_back\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003etemplate\u003c/span\u003e \u0026#x3C;\u003cspan class=\"hljs-keyword\"\u003etypename\u003c/span\u003e T\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eread\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(T \u0026#x26;x)\u003c/span\u003e\u003c/span\u003e{\n\tx=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\u003cspan class=\"hljs-type\"\u003echar\u003c/span\u003e c=\u003cspan class=\"hljs-built_in\"\u003egetchar\u003c/span\u003e();\u003cspan class=\"hljs-type\"\u003ebool\u003c/span\u003e f=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(;c\u0026#x3C;\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e||c\u003e\u003cspan class=\"hljs-string\"\u003e'9'\u003c/span\u003e;c=\u003cspan class=\"hljs-built_in\"\u003egetchar\u003c/span\u003e()) f|=(c==\u003cspan class=\"hljs-string\"\u003e'-'\u003c/span\u003e);\n\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(;c\u003e=\u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e\u0026#x26;\u0026#x26;c\u0026#x3C;=\u003cspan class=\"hljs-string\"\u003e'9'\u003c/span\u003e;c=\u003cspan class=\"hljs-built_in\"\u003egetchar\u003c/span\u003e())\n\tx=(x\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)+(x\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)+(c^\u003cspan class=\"hljs-number\"\u003e48\u003c/span\u003e);\n\tx=(f?-x:x);\n}\n\u003cspan class=\"hljs-type\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e N=\u003cspan class=\"hljs-number\"\u003e4e5\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e+5\u003c/span\u003e;\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e n, m, c;\n\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e a[N];\nll sum[N];\n\u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eT1\u003c/span\u003e{\n\t\u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003einfo\u003c/span\u003e{\n\t\tll ans, ls, rs, sum;\n\t\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eset\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e x)\u003c/span\u003e\u003c/span\u003e{\n\t\t\tsum=x;\n\t\t\tans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, x);\n\t\t\tls=rs=ans;\n\t\t}\n\t}tr[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n\t\u003cspan class=\"hljs-keyword\"\u003einline\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efriend\u003c/span\u003e info \u003cspan class=\"hljs-keyword\"\u003eoperator\u003c/span\u003e +(info x, info y){\n\t\tinfo z;\n\t\tz.ans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(x.ans, y.ans);\n\t\tz.sum=x.sum+y.sum;\n\t\tz.ls=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(x.ls, x.sum+y.ls);\n\t\tz.rs=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(y.rs, y.sum+x.rs);\n\t\tz.ans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(z.ans, x.rs+y.ls);\n\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e z;\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ebuild\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(l==r){\n\t\t\ttr[p].\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(a[l]);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid);\n\t\t\u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r);\n\t\ttr[p]=tr[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+tr[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emdf\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e x, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e v)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(l==r){\n\t\t\ttr[p].\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(v);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(x\u0026#x3C;=mid) \u003cspan class=\"hljs-built_in\"\u003emdf\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid, x, v);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003emdf\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r, x, v);\n\t\ttr[p]=tr[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+tr[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e];\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eget\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e L, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e R, info \u0026#x26;ret)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u003eR) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=l\u0026#x26;\u0026#x26;r\u0026#x3C;=R){\n\t\t\tret=ret+tr[p];\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=mid) \u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid, L, R, ret);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(R\u003emid) \u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r, L, R, ret);\n\t}\n}t1;\n\u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eT2\u003c/span\u003e{\n\tll a[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], b[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], mx[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], taga[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], tagb[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ebuild\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(l==r){\n\t\t\ta[p]=sum[l]; b[p]=sum[l+c];\n\t\t\tmx[p]=b[p]-a[p];\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid); \u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r);\n\t\ta[p]=\u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e(a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tb[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tmx[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]), b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]-a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edown\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(taga[p]!=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e){\n\t\t\ttaga[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=taga[p];\n\t\t\ta[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=taga[p];\n\t\t\tmx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]-=taga[p];\n\t\t\ttaga[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=taga[p];\n\t\t\ta[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=taga[p];\n\t\t\tmx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]-=taga[p];\n\t\t\ttaga[p]=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tagb[p]!=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e){\n\t\t\ttagb[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=tagb[p];\n\t\t\tb[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=tagb[p];\n\t\t\tmx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=tagb[p];\n\t\t\ttagb[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=tagb[p];\n\t\t\tb[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=tagb[p];\n\t\t\tmx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]+=tagb[p];\n\t\t\ttagb[p]=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\t}\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emdfa\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e L, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e R, ll v)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u003eR) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=l\u0026#x26;\u0026#x26;r\u0026#x3C;=R){\n\t\t\ttaga[p]+=v;\n\t\t\ta[p]+=v;\n\t\t\tmx[p]-=v;\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-built_in\"\u003edown\u003c/span\u003e(p);\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=mid) \u003cspan class=\"hljs-built_in\"\u003emdfa\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid, L, R, v);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(R\u003emid) \u003cspan class=\"hljs-built_in\"\u003emdfa\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r, L, R, v);\n\t\ta[p]=\u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e(a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tb[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tmx[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]), b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]-a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emdfb\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e L, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e R, ll v)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u003eR) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=l\u0026#x26;\u0026#x26;r\u0026#x3C;=R){\n\t\t\ttagb[p]+=v;\n\t\t\tb[p]+=v;\n\t\t\tmx[p]+=v;\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-built_in\"\u003edown\u003c/span\u003e(p);\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=mid) \u003cspan class=\"hljs-built_in\"\u003emdfb\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid, L, R, v);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(R\u003emid) \u003cspan class=\"hljs-built_in\"\u003emdfb\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r, L, R, v);\n\t\ta[p]=\u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e(a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tb[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tmx[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]), b[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]-a[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eqry\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e L, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e R, ll \u0026#x26;pa, ll \u0026#x26;pb, ll \u0026#x26;pans)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u003eR) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=l\u0026#x26;\u0026#x26;r\u0026#x3C;=R){\n\t\t\tpans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(pans, mx[p]), pb-a[p]);\n\t\t\tpa=\u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e(pa, a[p]);\n\t\t\tpb=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(pb, b[p]);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-built_in\"\u003edown\u003c/span\u003e(p);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=mid) \u003cspan class=\"hljs-built_in\"\u003eqry\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid, L, R, pa, pb, pans);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(R\u003emid) \u003cspan class=\"hljs-built_in\"\u003eqry\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r, L, R, pa, pb, pans);\n\t}\n}t2;\n\u003cspan class=\"hljs-keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eT3\u003c/span\u003e{\n\tll mx[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e], mx2[N\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e];\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ebuild\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(l==r){\n\t\t\tT1::info tem; tem.\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n, (l\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)*c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, l*c, tem);\n\t\t\tmx2[p]=tem.ans;\n\t\t\tmx[p]=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\t\tll pa=\u003cspan class=\"hljs-number\"\u003e1e18\u003c/span\u003e, pb=\u003cspan class=\"hljs-number\"\u003e-1e18\u003c/span\u003e;\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eqry\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, (l\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)*c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, l*c, pa, pb, mx[p]);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid); \u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r);\n\t\tmx[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tmx2[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx2[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], mx2[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t}\n\t\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003evoid\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emdf\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e x)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(l==r){\n\t\t\tT1::info tem; tem.\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n, (l\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)*c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, l*c, tem);\n\t\t\tmx2[p]=tem.ans;\n\t\t\tmx[p]=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\t\tll pa=\u003cspan class=\"hljs-number\"\u003e1e18\u003c/span\u003e, pb=\u003cspan class=\"hljs-number\"\u003e-1e18\u003c/span\u003e;\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eqry\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, (l\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)*c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, l*c, pa, pb, mx[p]);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ;\n\t\t}\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(x\u0026#x3C;=mid) \u003cspan class=\"hljs-built_in\"\u003emdf\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid, x);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003emdf\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r, x);\n\t\tmx[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], mx[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t\tmx2[p]=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx2[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e], mx2[p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n\t}\n\t\u003cspan class=\"hljs-function\"\u003ell \u003cspan class=\"hljs-title\"\u003eget\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e p, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e l, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e r, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e L, \u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e R)\u003c/span\u003e\u003c/span\u003e{\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u003eR) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=l\u0026#x26;\u0026#x26;r\u0026#x3C;=R) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(mx[p], mx2[p]);\n\t\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e mid=(l+r)\u003e\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e; ll ret=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(L\u0026#x3C;=mid) ret=\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, l, mid, L, R);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(R\u003emid) ret=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(ret, \u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(p\u0026#x3C;\u0026#x3C;\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e|\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, mid\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, r, L, R));\n\t\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e ret;\n\t}\n}t3;\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003emain\u003c/span\u003e\u003cspan class=\"hljs-params\"\u003e()\u003c/span\u003e\u003c/span\u003e{\n\t\u003cspan class=\"hljs-comment\"\u003e// freopen(\"D:\\\\nya\\\\acm\\\\A\\\\test.in\",\"r\",stdin);\u003c/span\u003e\n\t\u003cspan class=\"hljs-comment\"\u003e// freopen(\"D:\\\\nya\\\\acm\\\\A\\\\test.out\",\"w\",stdout);\u003c/span\u003e\n\t\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(n); \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(m); \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(c);\n\t\u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e(\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e i=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e; i\u0026#x3C;=n; ++i) \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(a[i]), sum[i]=sum[i\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e]+a[i];\n\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(n==c) a[++n]=\u003cspan class=\"hljs-number\"\u003e-1e9\u003c/span\u003e, sum[n]=sum[n\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e]+a[n];\n\t\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e(n%c) a[++n]=\u003cspan class=\"hljs-number\"\u003e-1e9\u003c/span\u003e, sum[n]=sum[n\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e]+a[n];\n\tt\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n);\n\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c);\n\tt\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ebuild\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n/c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e);\n\t\u003cspan class=\"hljs-type\"\u003eint\u003c/span\u003e tp, x, y;\n\t\u003cspan class=\"hljs-keyword\"\u003ewhile\u003c/span\u003e(m--){\n\t\t\u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(tp); \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(x); \u003cspan class=\"hljs-built_in\"\u003eread\u003c/span\u003e(y);\n\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(tp==\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e){\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdf\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n, x, y);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfa\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, x, n-c, y-a[x]);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfb\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, x-c), n-c, y-a[x]);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003e=\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) t\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdf\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n/c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, (x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e\u0026#x3C;=n/c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e) t\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdf\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n/c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, (x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e);\n\t\t\ta[x]=y;\n\t\t}\n\t\t\u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e{\n\t\t\tll ans=\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\t\t\tll pa=\u003cspan class=\"hljs-number\"\u003e1e18\u003c/span\u003e, pb=\u003cspan class=\"hljs-number\"\u003e-1e18\u003c/span\u003e;\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfa\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1e16\u003c/span\u003e); t\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfa\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, y\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-number\"\u003e1e16\u003c/span\u003e);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfb\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, x-c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e-1e16\u003c/span\u003e); t\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfb\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, y-c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e), n-c, \u003cspan class=\"hljs-number\"\u003e-1e16\u003c/span\u003e);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eqry\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, x, \u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e(n-c, x+c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e), pa, pb, ans);\n\t\t\tpa=\u003cspan class=\"hljs-number\"\u003e1e18\u003c/span\u003e, pb=\u003cspan class=\"hljs-number\"\u003e-1e18\u003c/span\u003e;\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eqry\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, y-c*\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e), y-c, pa, pb, ans);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfa\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e-1e16\u003c/span\u003e); t\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfa\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, y\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-number\"\u003e-1e16\u003c/span\u003e);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfb\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, x-c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1e16\u003c/span\u003e); t\u003cspan class=\"hljs-number\"\u003e2.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003emdfb\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n-c, \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, y-c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e), n-c, \u003cspan class=\"hljs-number\"\u003e1e16\u003c/span\u003e);\n\t\t\tT1::info tem; tem.\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n, x, \u003cspan class=\"hljs-built_in\"\u003emin\u003c/span\u003e(y, x+c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e), tem);\n\t\t\tans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(ans, tem.ans);\n\t\t\ttem.\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\t\t\tt\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n, \u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(x, y-c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e), y, tem);\n\t\t\tans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(ans, tem.ans);\n\t\t\t\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e((y\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003e(x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e){\n\t\t\t\t\u003cspan class=\"hljs-comment\"\u003e// cout\u0026#x3C;\u0026#x3C;(x-1)/c+2\u0026#x3C;\u0026#x3C;' '\u0026#x3C;\u0026#x3C;(y-1)/c-1\u0026#x3C;\u0026#x3C;endl;\u003c/span\u003e\n\t\t\t\tans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(ans, t\u003cspan class=\"hljs-number\"\u003e3.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n/c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e, (x\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003cspan class=\"hljs-number\"\u003e+2\u003c/span\u003e, (y\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e));\n\t\t\t\ttem.\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\t\t\t\tt\u003cspan class=\"hljs-number\"\u003e1.\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, n, ((y\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)*c\u003cspan class=\"hljs-number\"\u003e+1\u003c/span\u003e, ((y\u003cspan class=\"hljs-number\"\u003e-1\u003c/span\u003e)/c)*c, tem);\n\t\t\t\tans=\u003cspan class=\"hljs-built_in\"\u003emax\u003c/span\u003e(ans, tem.ans);\n\t\t\t}\n\t\t\t\u003cspan class=\"hljs-built_in\"\u003eprintf\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\"%lld\\n\"\u003c/span\u003e, ans);\n\t\t}\n\t}\n\t\u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\u003c/code\u003e\u003c/pre\u003e\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"$L1e\",null,{\"raw\":\"$1f\",\"htmlContent\":\"$20\"}]\n"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\ne:null\n"])</script><script>self.__next_f.push([1,"10:{\"metadata\":[],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"15:\"$10:metadata\"\n"])</script></body></html>