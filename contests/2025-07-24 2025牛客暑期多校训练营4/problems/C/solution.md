### C. Computational Geometry Problem

如果只看前两条性质，这就是 Fuss-Catalan 数。每个合法序列对应唯一的构造方式：

- 重复 $m$ 次以下步骤：
    - 任选一个没有出现过的数字 $x$；
    - 任选当前序列中两个相邻的位置（但是右侧的数字不可以是同种中第一次出现的那个），在其中插入 $n$ 个 $x$.

显然插入数字的顺序无关紧要，故我们认为数字不区分，最后乘上 $m!$ 即可。

现在问题在于第三条限制怎么处理。不思考，直接大力，用 $y$ 记录有多少个相邻相同的位置：

$$F(x,y) = x (F+y)^{n-1} (F+1)$$

其中 $(F+y)^{n-1}$ 对应中间的 $n-1$ 个空可以选择插入，也可以不插入（这样多一个相邻相同的位置）；最后的位置不插入没有贡献。

上拉格朗日反演：

$$x = G (x+y)^{n-1} (x+1)$$

$$G^{-1} = \dfrac{x+1}{x} (x+y)^{n-1}$$

$$
\begin{aligned}
[x^m] F(x,y) &= \dfrac{1}{m} [x^{m-1}] (xG^{-1})^m \\
&= \dfrac{1}{m} [x^{m-1}] (x+1)^m (x+y)^{m(n-1)} \\
&= \dfrac{1}{m} \sum\limits_{i=0}^m \dbinom{m}{i} \dbinom{m(n-1)}{m-1-i} y^{m(n-2)+i+1}
\end{aligned}
$$

我们需要算 $[x^m y^k]$ 项，所以 $i=k-m(n-2)-1$。计算组合数即可。时间复杂度 $O(m)$。